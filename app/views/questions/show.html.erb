<%= include_javascripts :question %>

<div id="questions-box">
  <ul id="questions-breadcrumb">
    <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb" class="breadcrumb-item breadcrumb-home"><a href="/" itemprop="url" title="Ir a la Portada"><span itemprop="title">Home</span></a></li>
    <li itemprop="child" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb" class="breadcrumb-item breadcrumb-tag"><a href="/tags/limpieza" itemprop="url" title="Ir a la categoría Limpieza"><span itemprop="title">Limpieza</span></a></li>
  </ul>
  <ul id="questions-header">
    <li class="new-question">
  	  <%= link_to 'Nueva pregunta', root_path(:scoped_questions => params[:scoped_questions]) + '#new_question', :title => "Crea una nueva pregunta"%>
  	</li>
  </ul>

  <ul id="questions-list">
    <%= render :partial => 'shared/question', :locals => { :question => @question } %>
  </ul>

  <div id="answers-header">
  	<ul id="answers-header-menu">
  		<li <%= tab_selected?(params[:order]) %>><%= link_to "Votos", question_path(@question, :order => 'votes_count'), :title => "Ordenar respuestas por número de votos", :class => "answers-header-menu-item", :id => "votes_count" %></li>
  		<li <%= tab_selected?(params[:order], 'created_at') %>><%= link_to "Fecha", question_path(@question, :order => 'created_at'), :title => "Ordenar respuestas por fecha", :class => "answers-header-menu-item", :id => "created_at" %></li>
  	</ul>
  </div>

  <!-- if answers -->
  <ul id="answers-list">
    <% @question.answers.each do |answer| %>
      <%- unless answer.id.blank? %>
        <li id="answer-<%= answer.id %>" class="answer">
        	<div class="commands">
      			<div class="votes">
          		<%- if user_signed_in? %>
        				<!-- Positive vote form: Change format (:html to :json) to do this with JS -->
        				<%= form_for(answer.votes.build, :format => :html) do |f| %>
                  <%= f.hidden_field :user_id, :value => current_user.id %>
        					<%= f.hidden_field :value, :value => 1 %>
        					<%= f.hidden_field :votable_id, :value => answer.id %>
        					<%= f.hidden_field :votable_type, :value => answer.class %>
        					<div class="actions">
                  	<%= f.submit '+', :id => "vote_submit_#{answer.id}" %>
                  </div>
                <% end %>
        				<!-- Negative vote form: Change format (:html to :json) to do this with JS  -->
        				<%= form_for(answer.votes.build, :format => :html) do |f| %>
                  <%= f.hidden_field :user_id, :value => current_user.id %>
        					<%= f.hidden_field :value, :value => -1 %>
        					<%= f.hidden_field :votable_id, :value => answer.id %>
        					<%= f.hidden_field :votable_type, :value => answer.class %>
        					<div class="actions">
                  	<%= f.submit '-', :id => "vote_submit_#{answer.id}" %>
                  </div>
                <% end %>
        				<%= link_to content_tag(:span, "+"), root_path, :title => "Voto positivo", :class => "command-item up" %>
        				<%= link_to content_tag(:span, "-"), root_path, :title => "Voto negativo", :class => "command-item down" %>
              <% else -%>
        				<%= link_to content_tag(:span, "+"), new_user_session_path, :title => "Voto positivo", :class => "command-item up" %>
        				<%= link_to content_tag(:span, "-"), new_user_session_path, :title => "Voto negativo", :class => "command-item down" %>
            	<% end -%>
      			</div>
        	</div>

          <p class="answer-description"><%= answer.content %></p>

          <div class="answer-meta">
            <p>
							Por <%= link_to answer.user.name, answer.user %> hace <abbr title="<%= answer.created_at %>"><%= time_ago_in_words(answer.created_at) %></abbr>
							<%- if current_user === answer.user %> 
								<%= link_to 'editar', edit_question_answer_path(@question, answer) %> 
								<%= link_to 'eliminar', [@question, answer], :confirm => 'Estás seguro?', :method => :delete %>
							<% end -%>
						</p>
          </div>
        </li>
      <% end -%>
    <% end %>
  </ul>

  <%= render 'answers/form' %>
</div>